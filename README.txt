Задача(sql_query): Сформировать таблицу сессий пользователей из таблицы событий.

Сессия – набор последовательных событий по одному пользователю.

Событие считается первым в сессии если:

Это событие - session_start
Предыдущие событие - session_end
От предыдущего события прошло более 30 минут
Наступил новый календарный день
Это первое событие пользователя за все время
Необходимо написать SQL-запрос, который создаст таблицу сессий пользователей.

Таблица должна состоять из следующих полей:

SESSION_ID – уникальный идентификатор сессии
SESSION_START_DTM – дата и время начала сессии
SESSION_END_DTM – дата и время конца сессии
USER_ID – идентификатор пользователя
SESSION_NUMBER – порядковый номер сессии для данного пользователя
IS_CLIENT – поле, которое обозначает, является ли пользователь клиентом (пользователь является клиентом, если за всю историю у него было хотя бы одно событие purchase, не важно в рамках текущей сессии или нет)
Дополнительно: сессия не может состоять только из событий session_start и session_end, такие сессии не должны попасть в результирующую таблицу и не учитываются при формировании поля SESSION_NUMBER.